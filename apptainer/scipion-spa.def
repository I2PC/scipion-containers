Bootstrap: localimage
From: example_base.sif

%labels
  Maintainer1 miceta@cnb.csic.es
  Maintainer2 md.sanchez@cnb.csic.es
 # version 24.02.1

%help
  SPA package add-on for Apptainer/Singularity base image
  

%post
export DEBIAN_FRONTEND=noninteractive

# Create the /run/user directory with appropriate permissions (chimera)
mkdir -p /run/user/8358
chmod 0700 /run/user/8358

# Dependencies
apt-get update
# needed libraries
# relion
apt-get install -y --no-install-recommends --no-install-suggests build-essential mpi-default-bin mpi-default-dev libtiff-dev libpng-dev ghostscript libxft-dev
# chimera
apt-get install -y xcb libxcb1-dev libxkbfile-dev qt6-base-dev qtbase5-dev libglu1-mesa libcanberra-gtk-module libcanberra-gtk3-module packagekit-gtk3-module


# Installing ChimeraX
git clone -b mit_chimerax_containers https://github.com/scipion-em/scipion-em-chimera /scipion/scipion-em-chimera
ln -s /usr/lib/x86_64-linux-gnu/libffi.so.8 /usr/lib/x86_64-linux-gnu/libffi.so.6
/scipion/scipion3 installp -p /scipion/scipion-em-chimera --devel


# /scipion/scipion3 installp -p scipion-em-continuousflex 
# /scipion/scipion3 installp -p scipion-em-empiar
# /scipion/scipion3 installp -p scipion-em-flexutils
# /scipion/scipion3 installp -p scipion-em-topaz
# /scipion/scipion3 installp -p scipion-em-gautomatch
# /scipion/scipion3 installp -p scipion-em-gctf


/scipion/scipion3 installp -p scipion-em-sphire
/scipion/scipion3 installp -p scipion-em-spider
/scipion/scipion3 installp -p scipion-em-spoc
/scipion/scipion3 installp -p scipion-em-warp
/scipion/scipion3 installp -p scipion-em-sidesplitter
/scipion/scipion3 installp -p scipion-em-repic
/scipion/scipion3 installp -p scipion-em-resmap
/scipion/scipion3 installp -p scipion-em-relion
/scipion/scipion3 installp -p scipion-em-bsoft
/scipion/scipion3 installp -p scipion-em-cistem
/scipion/scipion3 installp -p scipion-em-cryoassess
/scipion/scipion3 installp -p scipion-em-cryodrgn
/scipion/scipion3 installp -p scipion-em-cryoef
/scipion/scipion3 installp -p scipion-em-eman2
/scipion/scipion3 installp -p scipion-em-facilities
/scipion/scipion3 installp -p scipion-em-fsc3d
/scipion/scipion3 installp -p scipion-em-localrec
/scipion/scipion3 installp -p scipion-em-motioncorr
/scipion/scipion3 installp -p scipion-em-prody

