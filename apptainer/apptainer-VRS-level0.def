Bootstrap: localimage
From: /home/irene/PycharmProjects/scipion-containers/build/apptainer-base:latest.sif

%labels
  Maintainer1 miceta@cnb.csic.es
  Maintainer2 md.sanchez@cnb.csic.es
  Maintainer3 isanchez@cnb.csic.es
 # version 25.03.1

%help
  VRS level 0 package add-on for Apptainer/Singularity base image

%post
    set +e
    export DEBIAN_FRONTEND=noninteractive

    # Dependencies
    apt-get update
    # needed libraries
    # pdflatex
    apt-get install -y texlive-latex-extra

    # deepLearningToolkit
    # remove the following lines when the scipion-em-xmipp installed in base image is >= 3.25.06.0 (Rhea)
    /scipion/scipion3 uninstallp -p scipion-em-xmipp
    cd /scipion
    git clone https://github.com/I2PC/xmipp.git xmipp-bundle && cd xmipp-bundle
    /scipion/scipion3 run ./xmipp
    /scipion/scipion3 installp -p /scipion/xmipp-bundle/src/scipion-em-xmipp --devel -j $(nproc)
    /scipion/scipion3 installp -p /scipion/xmipp-bundle/src/scipion-em-xmipp --devel -j $(nproc)
    /scipion/scipion3 installb deepLearningToolkit

    git clone https://gitlab.com/jordibc/scipion-em-ucm.git /scipion/scipion-em-ucm
    /scipion/scipion3 installp -p /scipion/scipion-em-ucm --devel

    git clone -b apptainer https://github.com/I2PC/scipion-em-validation /scipion/scipion-em-validation
    /scipion/scipion3 pip install -r /scipion/scipion-em-validation/requirements.txt